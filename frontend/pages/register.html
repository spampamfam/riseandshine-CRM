<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - CRM Pro</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
</head>
<body>
    <div class="container">
        <header class="header">
            <nav class="nav">
                <div class="nav-brand">
                    <a href="../index.html" style="text-decoration: none; color: inherit;">
                        <h1>üìä CRM Pro</h1>
                    </a>
                </div>
                <div class="nav-menu">
                    <button class="theme-toggle" id="themeToggle">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <a href="login.html" class="btn btn-secondary">Sign In</a>
                </div>
            </nav>
        </header>

        <main class="main">
            <div class="form-container">
                <h1 class="form-title">Create Account</h1>
                <p class="text-center mb-4" style="color: var(--text-secondary);">
                    Join thousands of businesses using our CRM
                </p>
                
                <form id="registerForm" class="register-form">
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            required 
                            placeholder="Enter your email"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            required 
                            placeholder="Create a password (min 6 characters)"
                            minlength="6"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            class="form-input" 
                            required 
                            placeholder="Confirm your password"
                        >
                    </div>
                    
                    <div class="form-checkbox">
                        <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                        <label for="agreeTerms">I agree to the <a href="#terms">Terms of Service</a> and <a href="#privacy">Privacy Policy</a></label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary form-submit">
                        <span id="submitText">Create Account</span>
                        <span id="loadingText" class="hidden">Creating account...</span>
                    </button>
                </form>
                
                <div class="form-link">
                    <p>Already have an account? <a href="login.html">Sign in here</a></p>
                </div>
                
                <div class="form-link">
                    <p><a href="../index.html">‚Üê Back to home</a></p>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/theme.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Registration form handling
        document.addEventListener('DOMContentLoaded', () => {
            const registerForm = document.getElementById('registerForm');
            const submitText = document.getElementById('submitText');
            const loadingText = document.getElementById('loadingText');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            // Password confirmation validation
            function validatePasswordMatch() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (confirmPassword && password !== confirmPassword) {
                    confirmPasswordInput.setCustomValidity('Passwords do not match');
                } else {
                    confirmPasswordInput.setCustomValidity('');
                }
            }
            
            passwordInput.addEventListener('input', validatePasswordMatch);
            confirmPasswordInput.addEventListener('input', validatePasswordMatch);
            
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Validate password match
                validatePasswordMatch();
                
                if (!registerForm.checkValidity()) {
                    return;
                }
                
                // Show loading state
                submitText.classList.add('hidden');
                loadingText.classList.remove('hidden');
                
                const formData = new FormData(registerForm);
                const email = formData.get('email');
                const password = formData.get('password');
                
                try {
                    const response = await fetch('https://riseandshine-crm-production.up.railway.app/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            email,
                            password
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Show success message
                        if (window.crmApp) {
                            window.crmApp.showNotification('Account created successfully! Redirecting to dashboard...', 'success');
                        }
                        
                        // Redirect to dashboard
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    } else {
                        throw new Error(data.error || 'Registration failed');
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    
                    // Show error message
                    if (window.crmApp) {
                        window.crmApp.showNotification(error.message || 'Registration failed. Please try again.', 'error');
                    }
                    
                    // Reset form
                    registerForm.reset();
                } finally {
                    // Hide loading state
                    submitText.classList.remove('hidden');
                    loadingText.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html> 