<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CRM Pro</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <style>
        .form-section {
            margin-bottom: 2rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .dashboard-tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .duplicate-warning {
            background: var(--warning-color, #ff9800);
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <nav class="nav">
                <div class="nav-brand">
                    <h1>ðŸ“Š CRM Pro</h1>
                </div>
                <div class="nav-menu">
                    <button class="theme-toggle" id="themeToggle">
                        <span class="theme-icon">ðŸŒ™</span>
                    </button>
                    <span id="userEmail" style="color: var(--text-secondary); margin-right: 1rem; cursor: pointer; text-decoration: underline;" onclick="dashboard.showProfileModal()"></span>
                    <a href="admin.html" class="btn btn-primary admin-only" style="margin-right: 1rem; display: none;">Admin Panel</a>
                    <button id="logoutBtn" class="btn btn-secondary">Logout</button>
                </div>
            </nav>
        </header>

        <main class="main">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">My Dashboard</h1>
                    <div class="dashboard-actions">
                        <button id="addLeadBtn" class="btn btn-primary">+ Add Lead</button>
                        <button id="exportBtn" class="btn btn-outline admin-only" style="display: none;">Export CSV</button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalLeads">0</div>
                        <div class="stat-label">Total Leads</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQualifiedThisMonth">0</div>
                        <div class="stat-label">Total Qualified Leads This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="qualifiedLeads">0</div>
                        <div class="stat-label">Qualified</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="disqualifiedLeads">0</div>
                        <div class="stat-label">Disqualified</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="callbackLeads">0</div>
                        <div class="stat-label">Callback</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inventoryLeads">0</div>
                        <div class="stat-label">Inventory</div>
                    </div>
                </div>

                <!-- Dashboard Tabs -->
                <div class="dashboard-tabs" style="margin-bottom: 2rem;">
                    <button class="tab-button active" data-tab="leads">My Leads</button>
                    <button class="tab-button" data-tab="leaderboard">Leaderboard</button>
                </div>

                <!-- Leads Tab -->
                <div id="leadsTab" class="tab-content active">
                    <div class="leads-table">
                        <div class="table-header">
                            <h2 class="table-title">My Leads</h2>
                            <div class="table-actions">
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    placeholder="Search leads..." 
                                    class="form-input"
                                    style="width: 200px; margin-right: 1rem;"
                                >
                                <select id="statusFilter" class="form-input" style="width: 150px; margin-right: 1rem;">
                                    <option value="">All Status</option>
                                    <option value="new">New</option>
                                    <option value="contacted">Contacted</option>
                                    <option value="qualified">Qualified</option>
                                    <option value="disqualified">Disqualified</option>
                                    <option value="callback">Callback</option>
                                    <option value="inventory">Inventory</option>
                                    <option value="duplicate">Duplicate</option>
                                    <option value="converted">Converted</option>
                                </select>
                            </div>
                        </div>

                    <!-- Leads Table -->
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Contact</th>
                                    <th>Source</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leadsTableBody">
                                <!-- Leads will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="pagination" style="padding: 1rem; text-align: center;">
                        <!-- Pagination will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div id="leaderboardTab" class="tab-content">
                <div class="leads-table">
                    <div class="table-header">
                        <h2 class="table-title">User Leaderboard</h2>
                        <div class="table-actions">
                            <select id="leaderboardPeriod" class="form-input" style="width: 150px; margin-right: 1rem;">
                                <option value="current_month">Current Month</option>
                                <option value="last_month">Last Month</option>
                                <option value="all_time">All Time</option>
                            </select>
                        </div>
                    </div>

                    <!-- Leaderboard Table -->
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>User</th>
                                    <th>Qualified Leads</th>
                                    <th>Disqualified Leads</th>
                                    <th>Duplicates</th>
                                    <th>Callbacks</th>
                                    <th>Total Leads</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardTableBody">
                                <!-- Leaderboard will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

    <!-- Add/Edit Lead Modal -->
    <div id="leadModal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Lead</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <form id="leadForm">
                <input type="hidden" id="leadId" name="leadId">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Basic Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadName" class="form-label">Name *</label>
                            <input type="text" id="leadName" name="name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="leadPhone" class="form-label">Phone Number *</label>
                            <input type="tel" id="leadPhone" name="phoneNumber" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="leadCampaign" class="form-label">Campaign *</label>
                        <select id="leadCampaign" name="campaign" class="form-input" required>
                            <option value="">Select Campaign</option>
                            <!-- Campaign options will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="leadListed" class="form-label">Listed *</label>
                        <select id="leadListed" name="listed" class="form-input" required>
                            <option value="">Select Listing Status</option>
                            <option value="listed_with_realtor">Listed with Realtor</option>
                            <option value="listed_by_owner">Listed by Owner</option>
                            <option value="not_listed">Not Listed</option>
                        </select>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Property Details</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadAP" class="form-label">AP (Asking Price) *</label>
                            <input type="number" id="leadAP" name="ap" class="form-input" required placeholder="Enter asking price">
                        </div>
                        <div class="form-group">
                            <label for="leadMV" class="form-label">MV (Market Value) *</label>
                            <input type="number" id="leadMV" name="mv" class="form-input" required placeholder="Enter market value">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadBedrooms" class="form-label">Bedrooms *</label>
                            <select id="leadBedrooms" name="bedrooms" class="form-input" required>
                                <option value="">Select</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6+">6+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leadBathrooms" class="form-label">Bathrooms *</label>
                            <select id="leadBathrooms" name="bathrooms" class="form-input" required>
                                <option value="">Select</option>
                                <option value="1">1</option>
                                <option value="1.5">1.5</option>
                                <option value="2">2</option>
                                <option value="2.5">2.5</option>
                                <option value="3">3</option>
                                <option value="3.5">3.5</option>
                                <option value="4">4</option>
                                <option value="4+">4+</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadCondition" class="form-label">Condition (1-10 Scale) *</label>
                            <select id="leadCondition" name="condition" class="form-input" required>
                                <option value="">Select Condition</option>
                                <option value="1">1 - Very Poor</option>
                                <option value="2">2 - Poor</option>
                                <option value="3">3 - Fair</option>
                                <option value="4">4 - Below Average</option>
                                <option value="5">5 - Average</option>
                                <option value="6">6 - Above Average</option>
                                <option value="7">7 - Good</option>
                                <option value="8">8 - Very Good</option>
                                <option value="9">9 - Excellent</option>
                                <option value="10">10 - Perfect</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leadOccupancy" class="form-label">Occupancy *</label>
                            <select id="leadOccupancy" name="occupancy" class="form-input" required>
                                <option value="">Select Occupancy</option>
                                <option value="owner_occupied">Owner Occupied</option>
                                <option value="tenants">Tenants</option>
                                <option value="vacant">Vacant</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="leadRepairs" class="form-label">Repairs Needed *</label>
                        <textarea id="leadRepairs" name="repairsNeeded" class="form-input" rows="3" required placeholder="Describe repairs needed..."></textarea>
                    </div>
                </div>

                <!-- Deal Information -->
                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Deal Information</h3>
                    <div class="form-group">
                        <label for="leadReason" class="form-label">Reason for Selling *</label>
                        <textarea id="leadReason" name="reason" class="form-input" rows="2" required placeholder="Why is the property being sold?"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="leadClosing" class="form-label">Closing Timeline *</label>
                        <input type="text" id="leadClosing" name="closing" class="form-input" required placeholder="e.g., ASAP, 30 days, 60 days">
                    </div>
                </div>

                <!-- Location -->
                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Location</h3>
                    <div class="form-group">
                        <label for="leadAddress" class="form-label">Address *</label>
                        <textarea id="leadAddress" name="address" class="form-input" rows="2" required placeholder="Enter full property address"></textarea>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Additional Information</h3>
                    <div class="form-group">
                        <label for="leadAdditionalInfo" class="form-label">Additional Info *</label>
                        <textarea id="leadAdditionalInfo" name="additionalInfo" class="form-input" rows="4" required placeholder="Any additional notes or information..."></textarea>
                    </div>
                </div>



                <div class="form-actions" style="display: flex; gap: 1rem; margin-top: 1.5rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" id="cancelModal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Lead</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Profile Information</h2>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div id="profileContent">
                <!-- Profile content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Delete</h2>
                <button class="modal-close" id="closeDeleteModal">&times;</button>
            </div>
            <p style="margin-bottom: 1.5rem;">Are you sure you want to delete this lead? This action cannot be undone.</p>
            <div class="form-actions" style="display: flex; gap: 1rem;">
                <button id="confirmDelete" class="btn btn-danger">Delete</button>
                <button id="cancelDelete" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Profile Information</h2>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div id="profileContent">
                <!-- Profile content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="../js/theme.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/dashboard.js"></script>
</body>
</html>